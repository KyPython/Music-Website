<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ky - Music Artist</title>
    <link rel="stylesheet" href="/desktop.css">
    <link rel="stylesheet" href="/mobile.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=BioRhyme&display=swap" rel="stylesheet">
</head>
<body>
    <div id="content-container">
        <p class="loading-message">Loading content...</p>
    </div>

    <script>
        // Global initialization flag
        let initialized = false;
        
        // Function to detect if user is on mobile device
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }
        
        // Function to initialize the page
        function initializePage() {
            console.log('Initializing page');
            loadMainContent();
        }
        
        function loadMainContent() {
            const mobile = isMobile();
            const contentPath = mobile ? './Mobile/mobile.html' : './Desktop/desktop.html';
            const deviceType = mobile ? 'mobile' : 'desktop';
            
            console.log(`Loading ${deviceType} content...`);
            fetch(contentPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    console.log('Main content loaded successfully');
                    
                    // Create a temporary div to parse the HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    
                    // Modify the links in the parsed HTML before adding to the page
                    const legalLinks = tempDiv.querySelectorAll('.legal-links a');
                    const pathPrefix = mobile ? './Mobile/' : './Desktop/';
                    const suffix = mobile ? '-mobile.html' : '.html';
                    
                    legalLinks.forEach(link => {
                        const linkText = link.textContent.trim();
                        if (linkText === 'Privacy Policy') {
                            link.setAttribute('href', pathPrefix + 'privacy-policy' + suffix);
                            link.setAttribute('target', '_self');
                            link.removeAttribute('onclick');
                            link.removeAttribute('data-modal');
                        } else if (linkText === 'Terms of Service') {
                            link.setAttribute('href', pathPrefix + 'terms-of-service' + suffix);
                            link.setAttribute('target', '_self');
                            link.removeAttribute('onclick');
                            link.removeAttribute('data-modal');
                        } else if (linkText === 'Cookie Settings') {
                            link.setAttribute('href', pathPrefix + 'cookie-settings' + suffix);
                            link.setAttribute('target', '_self');
                            link.removeAttribute('onclick');
                            link.removeAttribute('data-modal');
                        }
                    });
                    
                    // Modify the home link
                    const homeLink = tempDiv.querySelector('#home');
                    if (homeLink) {
                        homeLink.setAttribute('href', './index.html');
                        homeLink.setAttribute('target', '_self');
                        homeLink.removeAttribute('onclick');
                    }
                    
                    // Now add the modified HTML to the page
                    document.getElementById('content-container').innerHTML = tempDiv.innerHTML;
                    
                    // Ensure CSS is loaded for the dynamically loaded content
                    ensureStylesLoaded(mobile);
                    
                    // Disable any JavaScript that might be interfering with links
                    disableInterfereingScripts();
                })
                .catch(error => {
                    console.error('Error loading desktop.html:', error);
                    document.getElementById('content-container').innerHTML = 
                        `<p class="error-message">Error loading content: ${error.message}</p>`;
                });
        }
        
        function ensureStylesLoaded(isMobile) {
            // Check if device-specific CSS is loaded
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            let hasDesktopCSS = false;
            let hasMobileCSS = false;
            
            links.forEach(link => {
                if (link.href.includes('desktop.css')) hasDesktopCSS = true;
                if (link.href.includes('mobile.css')) hasMobileCSS = true;
            });
            
            // Load missing CSS if needed
            if (!hasDesktopCSS) {
                const desktopCSS = document.createElement('link');
                desktopCSS.rel = 'stylesheet';
                desktopCSS.href = './Desktop/desktop.css';
                document.head.appendChild(desktopCSS);
            }
            
            if (!hasMobileCSS && isMobile) {
                const mobileCSS = document.createElement('link');
                mobileCSS.rel = 'stylesheet';
                mobileCSS.href = './Mobile/mobile.css';
                document.head.appendChild(mobileCSS);
            }
        }
        
        function disableInterfereingScripts() {
            // Prevent setupNavigation from desktop.js from running
            if (window.setupNavigation) {
                window.setupNavigation = function() {
                    console.log('Navigation setup disabled');
                };
            }
            
            // Prevent any click handlers on legal links
            document.querySelectorAll('.legal-links a').forEach(link => {
                link.onclick = function(e) {
                    // Let the default navigation happen
                    return true;
                };
            });
            
            // Prevent any click handlers on home link
            const homeLink = document.querySelector('#home');
            if (homeLink) {
                homeLink.onclick = function(e) {
                    // Let the default navigation happen
                    return true;
                };
            }
        }
        
        // Initialize on first load
        document.addEventListener('DOMContentLoaded', function() {
            if (!initialized) {
                initialized = true;
                initializePage();
            }
        });
        
        // Also check if we need to initialize when the page is already loaded
        if (document.readyState === 'complete' && !initialized) {
            initialized = true;
            initializePage();
        }
    </script>
</body>
</html>
